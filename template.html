<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Argo Roots">
        <meta http-equiv="refresh" content="600">
        <title>EKA Lobby</title>
        <link href='https://fonts.googleapis.com/css?family=Voces&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <style type="text/css" media="screen, print">
            html, body, table, tr, td, div, span, h1 {
                margin: 0px;
                padding: 0px;
            }
            html, body {
                overflow: hidden;
                background: #68217a;
                color: white;
                font-family: 'Voces', cursive;
            }
            table {
                width: 70%;
                border-collapse: collapse;
            }
            tr {
                border-bottom: 1px solid white;
            }
            tr:last-child {
                border-bottom: none;
            }
            td {
                padding: 5px 20px;
                vertical-align: middle;
                text-align: left;
                font-size: 22pt;
                line-height: 22pt;
            }
            td span {
                display: block;
                padding-top: 1px;
                font-size: 12pt;
                line-height: 12pt;
            }
            td.nowrap {
                white-space: nowrap;
            }
            #news {
                position: fixed;
                top: 0px;
                right: 0px;
                bottom: 0px;
                width: 30%;
                background: white;
                color: black;
            }
            .news-qr {
                display: block;
                margin: 20px auto;
            }
            .news-title {
                display: block;
                padding: 0px 20px;
                text-align: center;
                font-weight: bold;
                font-size: 22pt;
            }
            .news-text {
                display: block;
                padding: 20pt;
                font-size: 16pt;
            }
            .news-date {
                display: block;
                padding: 0px 20px;
                color: grey;
                text-align: right;
                font-size: 16pt;
            }
            #time {
                position: fixed;
                right: 0px;
                bottom: 0px;
                z-index: 1000;
                display: block;
                padding-bottom: 20px;
                width: 30%;
                background: white;
                color: #68217a;
                text-align: center;
                font-weight: bold;
                font-size: 60pt;
            }
            #time span.date {
                display: block;
                font-size: 24pt;
            }
            #time span.hidden {
                color: white;
            }
        </style>
    </head>
    <body>
        <table border="0">
            {% for e in events%}
                <tr>
                    <td class="nowrap">{{ e.get('start').strftime('%H:%M') }} - {{ e.get('end').strftime('%H:%M') }}</td>
                    <td class="nowrap">{{ e.get('room', '') }}<span>{{ e.get('info', '') }}</span></td>
                    <td>{{ e.get('summary', '') }}</td>
                </tr>
            {% endfor %}
        </table>
        <div id="news">
            {% for n in news %}
                <div id="news-item-{{ loop.index }}" class="news-item"{% if not loop.first %}style="display:none;"{% endif %}>
                    <img class="news-qr" src="https://chart.googleapis.com/chart?chs=120x120&cht=qr&chld=L|0&chl={{ n.get('link') }}" alt="QR" />
                    <div class="news-title">{{ n.get('title', '') }}</div>
                    <div class="news-text">{{ n.get('text', '') }}</div>
                    <div class="news-date">{{ n.get('date').strftime('%d.%m.%Y') }}</div>
                </div>
            {% endfor %}
            <div id="time">
            </div>
        </div>
    </body>
    <script>
        $(document).ready(function(){

            function set_time() {
                months = new Array('jaanuar', 'veebruar', 'märts', 'aprill', 'mai', 'juuni', 'juuli', 'august', 'september', 'oktober', 'november', 'detsember');
                days = new Array('pühapäev', 'esmaspäev', 'teisipäev', 'kolmapäev', 'neljapäev', 'reede', 'laupäev');

                date = new Date;

                year = date.getFullYear();
                month = date.getMonth();
                day = date.getDay();

                d = date.getDate();
                h = date.getHours();
                m = date.getMinutes();
                s = date.getSeconds();

                if(s % 2) {
                    ts = ':';
                } else {
                    ts = '<span class="hidden">:</span>';
                }

                if(h<10) h = '0'+h;
                if(m<10) m = '0'+m;
                if(s<10) s = '0'+s;

                $('#time').html(h+ts+m+'<span class="date">'+days[day]+', '+d+'. '+months[month]+' '+year+'</span>');

                setTimeout(set_time, 1000);
            }

            function set_news() {
                rnd = Math.floor((Math.random() * $('.news-item').length) + 1);
                $('.news-item').hide();
                $('#news-item-'+rnd).show();

                setTimeout(set_news, 20000);
            }

            set_time();
            set_news();

        });

    </script>
</html>
